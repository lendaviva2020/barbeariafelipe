{% extends "base.html" %}
{% load static %}

{% block title %}Agendar Horário - Barbearia Francisco{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/booking.css' %}">
{% endblock %}

{% block content %}
<div class="booking-container">
    <!-- Progress Steps -->
    <div class="booking-steps">
        <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-info">
                <span class="step-title">Serviço</span>
                <span class="step-subtitle">Escolha seu corte</span>
            </div>
        </div>
        <div class="step-line"></div>
        
        <div class="step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-info">
                <span class="step-title">Barbeiro</span>
                <span class="step-subtitle">Selecione quem prefere</span>
            </div>
        </div>
        <div class="step-line"></div>
        
        <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-info">
                <span class="step-title">Data/Hora</span>
                <span class="step-subtitle">Quando deseja agendar</span>
            </div>
        </div>
        <div class="step-line"></div>
        
        <div class="step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-info">
                <span class="step-title">Confirmação</span>
                <span class="step-subtitle">Finalize seu agendamento</span>
            </div>
        </div>
    </div>

    <!-- Booking Form -->
    <div class="booking-content">
        <!-- Step 1: Service Selection -->
        <div class="booking-step-content active" id="step-1">
            <h2 class="step-heading">Escolha o Serviço</h2>
            <p class="step-description">Selecione o serviço que deseja realizar</p>
            
            <div class="services-grid" id="servicesGrid">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando serviços...</p>
                </div>
            </div>

            <div class="step-actions">
                <button type="button" class="btn btn-secondary" disabled>Voltar</button>
                <button type="button" class="btn btn-primary" id="nextStep1" disabled>
                    Próximo <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 2: Barber Selection -->
        <div class="booking-step-content" id="step-2">
            <h2 class="step-heading">Escolha o Barbeiro</h2>
            <p class="step-description">Selecione seu barbeiro preferido (ou deixe em branco para qualquer um)</p>
            
            <div class="barbers-grid" id="barbersGrid">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando barbeiros...</p>
                </div>
            </div>

            <div class="step-actions">
                <button type="button" class="btn btn-secondary" id="prevStep2">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button type="button" class="btn btn-primary" id="nextStep2">
                    Próximo <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 3: Date & Time Selection -->
        <div class="booking-step-content" id="step-3">
            <h2 class="step-heading">Escolha Data e Horário</h2>
            <p class="step-description">Selecione quando deseja ser atendido</p>
            
            <div class="datetime-container">
                <div class="calendar-section">
                    <h3>Selecione a Data</h3>
                    <div id="calendar"></div>
                </div>

                <div class="time-section">
                    <h3>Horários Disponíveis</h3>
                    <div id="availableSlots" class="time-slots">
                        <p class="empty-state">Selecione uma data primeiro</p>
                    </div>
                </div>
            </div>

            <div class="step-actions">
                <button type="button" class="btn btn-secondary" id="prevStep3">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button type="button" class="btn btn-primary" id="nextStep3" disabled>
                    Próximo <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 4: Customer Info & Confirmation -->
        <div class="booking-step-content" id="step-4">
            <div class="confirmation-layout">
                <!-- Formulário -->
                <div class="customer-form">
                    <h2 class="step-heading">Seus Dados</h2>
                    <p class="step-description">Preencha suas informações para finalizarmos</p>

                    <form id="bookingForm">
                        <div class="form-group">
                            <label for="customerName">Nome Completo *</label>
                            <input type="text" id="customerName" class="form-control" required 
                                   placeholder="Seu nome completo">
                        </div>

                        <div class="form-group">
                            <label for="customerPhone">Telefone/WhatsApp *</label>
                            <input type="tel" id="customerPhone" class="form-control" required 
                                   placeholder="(11) 98765-4321">
                        </div>

                        <div class="form-group">
                            <label for="customerEmail">E-mail (opcional)</label>
                            <input type="email" id="customerEmail" class="form-control" 
                                   placeholder="seu@email.com">
                        </div>

                        <div class="form-group">
                            <label for="notes">Observações (opcional)</label>
                            <textarea id="notes" class="form-control" rows="3" 
                                      placeholder="Alguma observação especial?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="couponCode">Cupom de Desconto (opcional)</label>
                            <div class="coupon-input">
                                <input type="text" id="couponCode" class="form-control" 
                                       placeholder="Digite o código do cupom">
                                <button type="button" class="btn btn-secondary" id="applyCoupon">
                                    Aplicar
                                </button>
                            </div>
                            <div id="couponFeedback" class="coupon-feedback"></div>
                        </div>
                    </form>
                </div>

                <!-- Resumo -->
                <div class="booking-summary">
                    <h3>Resumo do Agendamento</h3>
                    
                    <div class="summary-item">
                        <span class="summary-label">Serviço:</span>
                        <span class="summary-value" id="summaryService">-</span>
                    </div>

                    <div class="summary-item">
                        <span class="summary-label">Barbeiro:</span>
                        <span class="summary-value" id="summaryBarber">Qualquer um disponível</span>
                    </div>

                    <div class="summary-item">
                        <span class="summary-label">Data:</span>
                        <span class="summary-value" id="summaryDate">-</span>
                    </div>

                    <div class="summary-item">
                        <span class="summary-label">Horário:</span>
                        <span class="summary-value" id="summaryTime">-</span>
                    </div>

                    <div class="summary-item">
                        <span class="summary-label">Duração:</span>
                        <span class="summary-value" id="summaryDuration">-</span>
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-item price-item">
                        <span class="summary-label">Subtotal:</span>
                        <span class="summary-value" id="summarySubtotal">R$ 0,00</span>
                    </div>

                    <div class="summary-item discount-item" id="discountItem" style="display: none;">
                        <span class="summary-label">Desconto:</span>
                        <span class="summary-value discount" id="summaryDiscount">- R$ 0,00</span>
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-item total-item">
                        <span class="summary-label">Total:</span>
                        <span class="summary-value total" id="summaryTotal">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <div class="step-actions">
                <button type="button" class="btn btn-secondary" id="prevStep4">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button type="button" class="btn btn-primary btn-lg" id="confirmBooking">
                    <i class="fas fa-check"></i> Confirmar Agendamento
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="modal-content success">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2>Agendamento Confirmado!</h2>
        <p>Seu horário foi reservado com sucesso.</p>
        <p class="success-details" id="successDetails"></p>
        <div class="modal-actions">
            <a href="{% url 'home' %}" class="btn btn-secondary">Voltar ao Início</a>
            <a href="{% url 'historico' %}" class="btn btn-primary">Ver Meus Agendamentos</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/booking.js' %}"></script>
{% endblock %}
